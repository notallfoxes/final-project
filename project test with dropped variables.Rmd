---
title: "Webtoons Project"
author: "Tonia Wu"
output: pdf_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(tidymodels)
library(ggplot2)
library(janitor)
library(splitstackshape)
library(randomForest)
# library(tune)
library(dplyr)
library(rpart.plot)
# library(yardstick)
# library(klaR)
# library(discrim)
# library(poissonreg)
# library(pROC)
# library(MASS)
# library(glmnet)
```



```{r}
rawdata <- read.csv('webtoon_originals_en_drop.csv')
```
# Content

# Data Cleaning

```{r, results = 'hide'}
webtoons <- rawdata %>%
  clean_names()
head(webtoons)
```
Count words in synopsis:
```{r, results = 'hide'}
webtoons <- webtoons %>%
  mutate(synopsis_length = str_count(synopsis))
```

Renaming the length column to the more descriptive 'free_episodes':
```{r, results='hide'}
webtoons <- webtoons %>%
  rename(free_episodes = length)
```
Parsing the days of the week into boolean columns:
```{r, results='hide'}
# webtoons <- cSplit_e(webtoons, 'weekdays', sep = ',', mode = 'binary',
#          type = 'character', fill = 0, drop = TRUE)
```
Renaming columns:
```{r, results='hide'}
# colnames(webtoons)[colnames(webtoons) == 'weekdays_SUNDAY'] <- 'sunday'
# colnames(webtoons)[colnames(webtoons) == 'weekdays_MONDAY'] <- 'monday'
# colnames(webtoons)[colnames(webtoons) == 'weekdays_TUESDAY'] <- 'tuesday'
# colnames(webtoons)[colnames(webtoons) == 'weekdays_WEDNESDAY'] <- 'wednesday'
# colnames(webtoons)[colnames(webtoons) == 'weekdays_THURSDAY'] <- 'thursday'
# colnames(webtoons)[colnames(webtoons) == 'weekdays_FRIDAY'] <- 'friday'
# colnames(webtoons)[colnames(webtoons) == 'weekdays_SATURDAY'] <- 'saturday'
```
Dummy coding the daily_pass variable to be consistent with the weekday variables:

```{r}
#webtoons$daily_pass <- ifelse(webtoons$daily_pass == TRUE, 1, 0)
head(webtoons)
```
Dropping unhelpful variables:
```{r, results = 'hide'}
webtoons <- webtoons%>%
  dplyr::select(-synopsis)

# webtoons <- webtoons%>%
#   dplyr::select(c(style, rating, views, likes, free_episodes, subscribers))
```
# Factors
Converting `status`, `original_platform`, `genre`, and `style`, `daily_pass`, and the day variables to factors:
```{r}
webtoons$style <- as.factor(webtoons$style)
# webtoons$status <- as.factor(webtoons$status)
# webtoons$original_platform <- as.factor(webtoons$original_platform)
# webtoons$genre <- as.factor(webtoons$genre)
# webtoons$monday <- as.factor(webtoons$monday)
# webtoons$tuesday <- as.factor(webtoons$tuesday)
# webtoons$wednesday <- as.factor(webtoons$wednesday)
# webtoons$thursday <- as.factor(webtoons$thursday)
# webtoons$friday <- as.factor(webtoons$friday)
# webtoons$saturday <- as.factor(webtoons$saturday)
# webtoons$sunday <- as.factor(webtoons$sunday)
# webtoons$daily_pass <- as.factor(webtoons$daily_pass)

```

Webtoons sometimes asks its creators to illustrate for their official "Tiptoons." These informative webtoons give tips on subjects such as how to stay healthy during the pandemic and how to edit your webtoon. As they are not a regular fictive comic, we will drop the genre.

```{r}
# webtoons <- subset(webtoons, genre != 'TIPTOON')
```

# Data Split
```{r}
set.seed(66)
w_split <- initial_split(webtoons, prop = 0.8, strata = 'style')
w_train <- training(w_split)
w_test <- testing(w_split)
```

# Recipe
v-fold cross validation with 5 folds, stratifying by style
```{r}
w_folds <- vfold_cv(data = w_train, v = 5, strata = 'style')
```

setting up recipe to predict style:
```{r}
w_recipe <- recipe(style ~ rating + views + 
                     free_episodes + likes + subscribers + synopsis_length,
                   data = w_train) %>%
  step_normalize(all_predictors()) 
```

# logistic regression
```{r}
log_mod <- logistic_reg(penalty = tune(),
                        mixture = tune()) %>%
  set_engine('glmnet') %>%
  set_mode('classification')

log_wkflow = workflow() %>%
  add_model(log_mod) %>%
  add_recipe(w_recipe)

log_grid = grid_regular(penalty(range = c(-5, 5)),
                        mixture(range = c(1, 2)),
                        levels = 5)

log_tune <- log_wkflow %>%
  tune_grid(resamples = w_folds,
            grid = log_grid )
```
```{r}
head(webtoons)
```
# rf
```{r}
rf_mod <-
  rand_forest(min_n = tune(), mtry = tune()) %>%
  set_mode('classification') %>%
  set_engine('randomForest')


rf_wkflow <- workflow() %>%
  add_model(rf_mod) %>%
  add_recipe(w_recipe)

rf_grid <- grid_regular(min_n(),
                        mtry(range = c(1, 4)),
                        levels = 3)

rf_tune <- rf_wkflow %>%
  tune_grid(resamples = w_folds,
    grid = rf_grid)

rf_tune %>% collect_metrics() %>%
  select(-.estimator, -.config)
```
```{r}
boost_mod <- boost_tree(trees = tune()) %>%
  set_engine('xgboost') %>%
  set_mode('classification')

boost_wkflow <- workflow() %>%
  add_model(boost_mod) %>%
  add_recipe(w_recipe)

boost_grid <- grid_regular(trees(c(10,100)),
                           levels = 3)

# tune_boost <- boost_wkflow %>%
#   tune_grid(resamples = w_folds,
#             grid = boost_grid)

tune_boost <- tune_grid(
  boost_wkflow,
  resamples = w_folds,
  grid = boost_grid
)
```
# decision tree
```{r}
tree_mod <- decision_tree() %>%
  set_engine('rpart')

tree_spec <- tree_mod %>%
  set_mode('classification')

tree_fit <- tree_spec %>%
  fit(style ~ free_episodes + subscribers + rating + views + likes + synopsis_length, data = w_train)

tree_fit %>%
  extract_fit_engine() %>%
  rpart.plot(roundint = FALSE)

augment(tree_fit, new_data = w_train) %>%
  accuracy(truth = style, estimate = .pred_class)

augment(tree_fit, new_data = w_train) %>%
  conf_mat(truth = style, estimate = .pred_class) %>%
  autoplot(type = "heatmap")
```

```{r}

```

```{r}

```